---
name: 'step-05-complete'
description: 'Finalize sync by generating report, updating sidecar state, and displaying summary'

# Path Definitions
workflow_path: '{project-root}/orion/workflows/jira-story-sync'

# File References
thisStepFile: '{workflow_path}/steps/step-05-complete.md'
workflowFile: '{workflow_path}/workflow.md'

# Output Files
reportFolder: '{project-root}/_bmad-output/sync-reports'
sidecarFile: '{project-root}/_bmad-output/jira-sync-state.yaml'
---

# Step 5: Complete

## STEP GOAL:

To finalize the sync workflow by generating a sync report, updating the sidecar state file, and displaying the completion summary.

## MANDATORY EXECUTION RULES (READ FIRST):

### Universal Rules:

- ğŸ›‘ NEVER skip report generation
- ğŸ“– CRITICAL: Read the complete step file before taking any action
- ğŸ“‹ Document everything that happened

### Role Reinforcement:

- âœ… You are a Jira Sync Specialist
- âœ… If you already have been given a name, communication_style and persona, continue to use those while playing this new role
- âœ… We engage in collaborative dialogue, not command-response
- âœ… You bring Jira integration expertise, user brings project context
- âœ… Maintain efficient, action-oriented tone throughout
- âœ… Comprehensive reporting
- âœ… Clear summary of results
- âœ… Proper state management

### Step-Specific Rules:

- ğŸ¯ Focus ONLY on finalization and reporting
- ğŸš« FORBIDDEN to execute any additional sync operations
- ğŸ’¬ Generate complete, accurate report
- ğŸšª This is the final step - end workflow gracefully

## EXECUTION PROTOCOLS:

- ğŸ¯ Generate sync report markdown file
- ğŸ’¾ Update sidecar state file
- ğŸ“– Display completion summary
- ğŸš« End workflow after completion

## CONTEXT BOUNDARIES:

- Results from step 4 are available
- Focus ONLY on reporting and state update
- Don't execute any new sync operations
- End the workflow session

## COMPLETION SEQUENCE:

### 1. Generate Sync Report

Create report file at `{reportFolder}/jira-sync-{timestamp}.md`:

```markdown
# Jira Sync Report

**Date:** {current_timestamp}
**Project:** {project_key}
**Epic:** {epic_id}

## Summary

| Action | Count | Status |
|--------|-------|--------|
| Created | {created_count} | {created_success}/{created_count} âœ… |
| Updated | {updated_count} | {updated_success}/{updated_count} âœ… |
| Pulled | {pulled_count} | {pulled_success}/{pulled_count} âœ… |
| Skipped | {skipped_count} | â€” |
| **Total** | {total} | {total_success}/{total_attempted} |

## Created Stories

{For each created story:}
| File | Jira Key | Status |
|------|----------|--------|
| `{filename}` | {jira_key} | âœ… Created |

## Updated Stories

{For each updated story:}
| File | Jira Key | Change | Status |
|------|----------|--------|--------|
| `{filename}` | {jira_key} | {change_type} | âœ… Updated |

## Pulled Status

{For each pulled story:}
| File | Jira Key | Jira Status | BMAD Status |
|------|----------|-------------|-------------|
| `{filename}` | {jira_key} | {jira_status} | {bmad_status} |

## Skipped Stories

{count} stories were unchanged and skipped.

## Errors

{If any failures:}
| File | Error |
|------|-------|
| `{filename}` | {error_message} |

{If no failures:}
No errors occurred during sync.

---

*Generated by Jira Story Sync workflow*
```

### 2. Update Sidecar State File

Update `{sidecarFile}` with current sync state:

```yaml
# Jira Story Sync State
# Last updated: {current_timestamp}

last_sync: {current_timestamp}
project_key: {project_key}
default_epic: {epic_id}
user_email: {user_email}
stories_path: {stories_path}

synced_stories:
  {For each successfully synced story:}
  - file: "{filename}"
    jira_key: "{jira_key}"
    last_synced: "{current_timestamp}"
    bmad_status: "{current_status}"
    jira_status: "{jira_status}"
```

### 3. Display Completion Summary

Display:
```
âœ… **Sync Complete!**

## Results

| Action | Result |
|--------|--------|
| âœ… Created | {created_success} stories |
| âœ… Updated | {updated_success} stories |
| âœ… Pulled | {pulled_success} stories |
| â­ï¸ Skipped | {skipped_count} stories |
| âŒ Failed | {failed_count} stories |

## Files Updated

ğŸ“„ **Sync Report:** `_bmad-output/sync-reports/jira-sync-{timestamp}.md`
ğŸ“„ **Sync State:** `_bmad-output/jira-sync-state.yaml`
ğŸ“„ **BMAD Stories:** {count} files updated with Jira keys

{If failures exist:}
âš ï¸ **{failed_count} operations failed.** Check the sync report for details.

---

**Jira Story Sync workflow complete.**
```

### 4. End Workflow

This is the final step. The workflow is complete.

**No menu needed - workflow ends here.**

Display closing message:
```
---

To run another sync, invoke the Jira Story Sync workflow again.
```

---

## ğŸš¨ SYSTEM SUCCESS/FAILURE METRICS

### âœ… SUCCESS:

- Sync report generated with accurate data
- Sidecar state file updated
- Completion summary displayed
- All results properly documented
- Workflow ended gracefully

### âŒ SYSTEM FAILURE:

- Not generating sync report
- Not updating sidecar state
- Inaccurate result counts
- Missing error documentation

**Master Rule:** Leave a complete record of what happened. The sync report and sidecar state are essential for future syncs and debugging.

